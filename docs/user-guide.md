# NAS 自动化系统用户指南

## 📖 目录
- [系统概述](#系统概述)
- [首次使用](#首次使用)
- [核心功能](#核心功能)
- [日常使用](#日常使用)
- [高级功能](#高级功能)
- [常见问题](#常见问题)

## 🎯 系统概述

NAS 自动化影音管理系统是一个基于"想看什么，点一下，然后就能在 Emby 里直接看"理念的全自动化数字媒体中心。

### 核心特性
- **全自动化流水线**: 搜索 → 下载 → 整理 → 通知
- **一站式管理**: 影视、音乐、漫画、电子书统一管理
- **多设备支持**: 手机、电视、电脑无缝访问
- **智能推荐**: 基于观看历史的个性化推荐

### 系统架构
```
用户需求 → MoviePilot 调度 → 下载器执行 → 媒体库整理 → Emby 播放 → 微信通知
```

## 🏁 首次使用

### 1. 访问导航页
打开浏览器访问: `http://你的服务器IP:3000`

导航页包含所有服务的快捷入口和系统状态监控。

### 2. 配置 MoviePilot（影视自动化管理）

#### 初始登录
1. 访问 MoviePilot: `http://你的服务器IP:8001`
2. 使用管理员账号登录（见 .env 配置文件）

#### 基础配置
1. **媒体库设置**
   - 电影路径: `/media/movies`
   - 电视剧路径: `/media/tv`
   - 动漫路径: `/media/anime`

2. **下载器配置**
   - qBittorrent: `http://qbittorrent:8080`
   - 用户名/密码: 见 .env 配置

3. **媒体服务器配置**
   - Emby 地址: `http://emby:8096`
   - API 密钥: 在 Emby 设置中获取

### 3. 配置 Emby（媒体服务器）

#### 初始设置
1. 访问 Emby: `http://你的服务器IP:8096`
2. 按照设置向导完成初始配置
3. 创建管理员账户

#### 添加媒体库
1. 进入"设置" → "媒体库"
2. 添加以下媒体库：
   - **电影库**: 路径 `/media/movies`
   - **电视剧库**: 路径 `/media/tv`
   - **音乐库**: 路径 `/media/music`
   - **动漫库**: 路径 `/media/anime`

#### 获取 API 密钥
1. 进入"设置" → "API 密钥"
2. 创建新的 API 密钥
3. 将密钥配置到 MoviePilot 中

## 🎬 核心功能

### 影视内容自动化管理

#### 搜索和添加内容
1. 在 MoviePilot 中搜索想要的影视内容
2. 选择合适的资源（建议选择高质量资源）
3. 点击"添加下载"
4. 系统自动完成：下载 → 重命名 → 移动到媒体库 → 刮削元数据

#### 订阅管理
- **电视剧订阅**: 自动下载新更新的剧集
- **演员订阅**: 关注特定演员的新作品
- **导演订阅**: 关注特定导演的新作品

#### 内容过滤
- **质量过滤**: 只下载指定质量的资源（如 1080p, 4K）
- **大小过滤**: 设置文件大小范围
- **制作组过滤**: 排除或偏好特定制作组

### 下载管理

#### qBittorrent（主力下载器）
- **访问地址**: `http://你的服务器IP:8080`
- **功能**: 新资源下载、高速下载
- **特点**: Web界面友好，支持RSS订阅

#### Transmission（保种下载器）
- **访问地址**: `http://你的服务器IP:9091`
- **功能**: 长期保种、刷流
- **特点**: 资源占用低，稳定性好

#### 下载流程
```
搜索资源 → 选择下载 → qBittorrent下载 → 完成后移动到媒体库 → 转移到Transmission保种
```

### 媒体库扩展服务

#### Komga（漫画服务器）
- **访问地址**: `http://你的服务器IP:25600`
- **支持格式**: CBZ, CBR, PDF
- **功能**: 漫画阅读、进度同步、移动端支持

#### Audiobookshelf（有声书服务器）
- **访问地址**: `http://你的服务器IP:25378`
- **支持格式**: MP3, M4A, M4B
- **功能**: 有声书播放、进度记忆、播放速度调节

#### Navidrome（音乐服务器）
- **访问地址**: `http://你的服务器IP:25533`
- **支持格式**: MP3, FLAC, AAC
- **功能**: 音乐播放、歌单管理、Subsonic API

## 📱 日常使用

### 移动端使用

#### Emby 客户端
- **iOS/Android**: 下载官方 Emby 应用
- **功能**: 视频播放、离线下载、投屏
- **设置**: 服务器地址填入你的 NAS IP:8096

#### 音乐客户端
- **推荐应用**: DSub, Ultrasonic (Android), play:Sub (iOS)
- **协议**: Subsonic API
- **服务器**: `http://你的NAS IP:25533`

#### 漫画客户端
- **Web 访问**: 直接使用浏览器访问 Komga
- **移动优化**: Komga 支持响应式设计

### 电视端使用

#### 安装 Emby 客户端
- **Android TV**: Google Play 商店下载
- **Apple TV**: App Store 下载
- **设置**: 添加服务器地址

#### 投屏功能
- **手机投屏**: 使用 Emby 应用投屏到电视
- **电脑投屏**: Chrome 浏览器投屏功能

### 桌面端使用

#### Web 界面
- **导航页**: `http://NAS-IP:3000` （推荐加入书签）
- **Emby**: 直接在浏览器中播放
- **管理界面**: 通过导航页访问各服务管理界面

#### 本地客户端
- **Emby Theater**: 官方桌面客户端
- **Kodi**: 使用 Emby for Kodi 插件

## 🔧 高级功能

### PT 站点整合

#### Cookie 同步（CookieCloud）
1. 安装浏览器扩展
2. 配置同步服务器: `http://你的NAS IP:8088`
3. 自动同步 PT 站点登录状态

#### 自动辅种（IYUU）
- **功能**: 自动为已有资源添加更多种子源
- **访问**: `http://你的NAS IP:9780`
- **配置**: 添加 PT 站点信息和下载器连接

#### 刷流工具（Vertex）
- **功能**: 自动下载小种子提升上传量
- **访问**: `http://你的NAS IP:3030`
- **注意**: 需要合理配置，避免过度使用

### 字幕管理

#### ChineseSubFinder
- **功能**: 自动下载中文字幕
- **访问**: `http://你的NAS IP:19035`
- **支持**: 多个字幕网站，智能匹配

### 通知系统

#### 微信通知
1. 配置企业微信应用
2. 在 MoviePilot 中配置通知参数
3. 下载完成、错误等事件自动推送

#### 邮件通知
- 配置 SMTP 服务器
- 支持告警、状态报告等通知

### RSS 订阅

#### FreshRSS
- **访问**: `http://你的NAS IP:8084`
- **功能**: RSS 阅读、订阅管理
- **整合**: 可订阅 PT 站点 RSS

#### RSSHub
- **功能**: 为各种网站生成 RSS 源
- **支持**: 微博、B站、知乎等国内网站

## 📊 系统监控

### 实时监控

#### Homepage 仪表板
- 系统资源使用情况
- 服务运行状态
- 网络流量统计

#### UptimeKuma（可选）
- **访问**: `http://你的NAS IP:9001`
- **功能**: 服务状态监控、告警通知

### 性能监控

#### Grafana 面板（可选）
- **访问**: `http://你的NAS IP:3001`
- **功能**: 详细的系统性能图表
- **指标**: CPU、内存、磁盘、网络使用情况

## 🛠️ 维护和管理

### 定期维护

#### 清理下载文件
```bash
# 清理完成的下载（保留做种）
find /opt/nas-data/downloads/complete -name "*.!qB" -delete

# 清理临时文件
docker system prune -f
```

#### 备份重要数据
```bash
# 运行备份脚本
./scripts/backup.sh

# 检查备份文件
ls -la /opt/nas-data/backup/
```

### 服务管理

#### 查看服务状态
```bash
# 使用管理脚本
./scripts/manage-services.sh status

# 直接使用 Docker
docker ps
```

#### 重启服务
```bash
# 重启所有服务
./scripts/manage-services.sh restart

# 重启单个服务
docker restart moviepilot
```

### 更新升级

#### 服务更新
```bash
# 更新所有服务
./scripts/manage-services.sh update

# 手动更新单个服务
docker-compose -f docker-compose.core.yml pull moviepilot
docker-compose -f docker-compose.core.yml up -d moviepilot
```

## ❓ 常见问题

### 下载相关

**Q: 为什么搜索不到资源？**
A: 
1. 检查 PT 站点是否正常登录
2. 确认 CookieCloud 同步状态
3. 检查网络连接

**Q: 下载速度很慢怎么办？**
A:
1. 检查网络带宽
2. 调整下载器连接数设置
3. 选择热门种子

**Q: 下载完成后文件没有自动整理？**
A:
1. 检查 MoviePilot 与下载器连接
2. 确认路径映射配置正确
3. 查看 MoviePilot 日志

### 播放相关

**Q: Emby 中看不到新添加的内容？**
A:
1. 手动刷新媒体库
2. 检查文件权限
3. 确认路径配置正确

**Q: 视频播放卡顿怎么办？**
A:
1. 检查网络带宽
2. 降低播放质量
3. 启用硬件加速转码

**Q: 字幕显示异常？**
A:
1. 检查字幕文件编码
2. 使用 ChineseSubFinder 重新下载
3. 手动添加字幕文件

### 系统相关

**Q: 服务无法启动？**
A:
1. 检查端口占用：`netstat -tlnp`
2. 查看容器日志：`docker logs container_name`
3. 检查磁盘空间：`df -h`

**Q: 系统运行缓慢？**
A:
1. 检查资源使用：`htop`
2. 清理 Docker 缓存：`docker system prune -f`
3. 重启服务：`./scripts/manage-services.sh restart`

**Q: 忘记管理员密码？**
A:
1. 查看 .env 配置文件
2. 重置 MoviePilot 配置
3. 重新运行安装脚本

## 📞 技术支持

### 获取帮助
- **项目文档**: 查看完整的项目 Wiki
- **GitHub Issues**: 提交问题和建议
- **社区支持**: 加入 QQ 群或微信群

### 问题反馈
提交问题时请包含：
1. 系统版本和配置信息
2. 具体的错误描述
3. 相关的日志信息
4. 复现步骤

### 贡献参与
欢迎参与项目改进：
- 提交 Bug 报告
- 完善文档
- 贡献代码
- 分享使用经验